#!/bin/bash
# 月報データ取得スクリプト

# 先月の日付範囲を計算
START_DATE=$(date -v-1m -v1d +%Y-%m-%dT00:00:00)
END_DATE=$(date -v1d -v-1d +%Y-%m-%dT23:59:59)

# screenpipeからデータ取得
curl -s "http://localhost:3030/search?start_time=${START_DATE}&end_time=${END_DATE}&limit=500" \
  | jq -r '[.data[].content.text // empty] | join("\n")' \
  | head -c 15000 \
  | ollama run gemma3:4b "以下は先月の作業ログです。月報用に案件ごとに要約してください。日本語で回答:"
